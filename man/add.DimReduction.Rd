% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main.R
\name{add.DimReduction}
\alias{add.DimReduction}
\title{Add a Custom Dimensionality Reduction to an scTypeEval Object}
\usage{
add.DimReduction(
  scTypeEval,
  embeddings,
  aggregation,
  ident = NULL,
  ident.name = "custom",
  sample = NULL,
  key = NULL,
  gene.list = NULL,
  black.list = NULL,
  feature.loadings = NULL,
  filter = FALSE,
  min.samples = 5,
  min.cells = 10,
  verbose = TRUE
)
}
\arguments{
\item{scTypeEval}{A \code{scTypeEval} object where the dimensionality reduction will be stored.}

\item{embeddings}{A numeric matrix of dimension-reduced embeddings (cells/samples x components).}

\item{aggregation}{Character. Aggregation level of the embeddings. Options:
\code{"single-cell"} (no aggregation) or \code{"pseudobulk"} (aggregated per sample and cell type).}

\item{ident}{Required. A vector of cell identities (e.g., cell type annotation).
If \code{NULL}, the function attempts to infer it.}

\item{ident.name}{Character. Name assigned to the provided \code{ident} grouping (default: \code{"custom"}).}

\item{sample}{Required. A vector indicating sample identity of each observation.
If \code{NULL}, the function attempts to infer it.}

\item{key}{Optional. Character. Key or label assigned to this dimensionality reduction (e.g., \code{"PCA"}, \code{"UMAP"}).}

\item{gene.list}{Optional. Character vector or named list of genes associated with the embeddings
(e.g., input features used for the dimensionality reduction). Default: \code{NULL}.}

\item{black.list}{Optional. Character vector of genes excluded from the dimensionality reduction.
Default: \code{NULL}.}

\item{feature.loadings}{Optional. Matrix of feature loadings corresponding to the embeddings
(e.g., PCA rotation matrix). Default: \code{NULL}.}

\item{filter}{Logical. If \code{TRUE}, filters cells before adding the embeddings based on
\code{min.samples} and \code{min.cells}. Only supported for \code{"single-cell"} aggregation.
Default: \code{FALSE}.}

\item{min.samples}{Integer. Minimum number of samples required for retaining a cell type in
single-cell filtering. Default: \code{5}.}

\item{min.cells}{Integer. Minimum number of cells required per group for filtering. Default: \code{10}.}

\item{verbose}{Logical. Whether to print messages during execution. Default: \code{TRUE}.}
}
\value{
The modified \code{scTypeEval} object with the new dimensionality reduction stored
in the \code{reductions} slot.
}
\description{
This function allows the user to insert pre-computed dimensionality reduction (e.g., PCA, UMAP,
t-SNE, or any embedding) into an \code{scTypeEval} object. The embeddings are stored in the
\code{reductions} slot as a \code{DimRed} object, enabling integration with the scTypeEval
workflow for downstream analysis.
}
\examples{
# Create synthetic test data
library(Matrix)
counts <- Matrix(rpois(1000, 5), nrow = 50, ncol = 20, sparse = TRUE)
rownames(counts) <- paste0("Gene", 1:50)
colnames(counts) <- paste0("Cell", 1:20)

metadata <- data.frame(
  celltype = rep(c("TypeA", "TypeB"), each = 10),
  sample = rep(paste0("Sample", 1:4), each = 5),
  row.names = colnames(counts)
)

# Create scTypeEval object from matrix
sceval <- create.scTypeEval(matrix = counts, metadata = metadata)

sceval <- create.scTypeEval(
  matrix = counts, 
  metadata = metadata,
  gene.lists = gene_list,
  active.ident = "celltype"
)

#' # Process data with filtering
sceval <- Run.ProcessingData(
  sceval,
  ident = "celltype",
  sample = "sample",
  min.samples = 3,
  min.cells = 3,
  verbose = FALSE
)

# Create mock embeddings
n_cells <- ncol(sceval@data[["single-cell"]]@matrix)
embeddings <- matrix(rnorm(n_cells * 10), nrow = 10, ncol = n_cells)

ident <- sceval@data[["single-cell"]]@ident[[1]]
sample <- sceval@data[["single-cell"]]@sample

sceval <- add.DimReduction(
   sceval,
   embeddings = embeddings,
   aggregation = "single-cell",
   ident = ident,
   sample = sample,
   key = "custom_embedding",
  verbose = FALSE
)

}
\seealso{
\link{Run.PCA}
}
