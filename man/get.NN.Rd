% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main.R
\name{get.NN}
\alias{get.NN}
\title{Compute K-Nearest Neighbor (KNN) Composition from Dissimilarity Assays}
\usage{
get.NN(
  scTypeEval,
  dissimilarity.slot = "all",
  KNNGraph_k = 5,
  normalize = FALSE,
  verbose = TRUE
)
}
\arguments{
\item{scTypeEval}{An object containing dissimilarity matrices and metadata.}

\item{dissimilarity.slot}{A character string specifying which dissimilarity assay(s)
to use. If \code{"all"}, all available dissimilarity assays are processed (default: \code{"all"}).}

\item{KNNGraph_k}{Integer; the number of neighbors to consider in the KNN graph (default: \code{5}).}

\item{normalize}{Logical; if \code{TRUE}, normalizes neighbor proportions relative to expected
frequencies of each cell type (default: \code{FALSE}).}

\item{verbose}{Logical; if \code{TRUE}, prints progress messages during computation (default: \code{TRUE}).}
}
\value{
A list (or a single data frame if only one assay is processed) where each element
corresponds to a dissimilarity assay. Each element contains a data frame with rows
corresponding to reference cell types and columns representing the mean proportion of
neighbors belonging to each cell type.
}
\description{
This function computes KNN-based neighborhood composition scores from dissimilarity
matrices stored in a \code{scTypeEval} object. For each dissimilarity assay, it constructs
a KNN graph, computes the cell type composition among neighbors
and aggregates results at the group level.
}
\details{
The function extracts dissimilarity matrices from the \code{scTypeEval} object and applies
a KNN graph construction. For each assay, it computes neighbor
cell-type proportions per cell and then aggregate them by cell type. If
normalization is enabled, the observed neighbor proportions are scaled relative to
the expected global frequency of each cell type.
}
\examples{
# Create and process test data
library(Matrix)
counts <- Matrix(rpois(6000, 5), nrow = 100, ncol = 60, sparse = TRUE)
rownames(counts) <- paste0("Gene", 1:100)
colnames(counts) <- paste0("Cell", 1:60)

metadata <- data.frame(
  celltype = rep(c("TypeA", "TypeB"), each = 30),
  sample = rep(paste0("Sample", 1:6), times = 10),
  row.names = colnames(counts)
)

sceval <- create.scTypeEval(matrix = counts, metadata = metadata)
sceval <- Run.ProcessingData(sceval, ident = "celltype",
                             sample = "sample", min.samples = 3,
                             min.cells = 3, verbose = FALSE)
sceval <- Run.HVG(sceval,
                  var.method = "basic",
                  ngenes = 10,
                  verbose = FALSE)

# Compute Pseudobulk Euclidean dissimilarity
sceval <- Run.Dissimilarity(sceval, method = "Pseudobulk:Euclidean",
                            reduction = FALSE, verbose = FALSE)
# Get nearest neighbors                            
result <- get.NN(scTypeEval = sceval,
                 KNNGraph_k = 5,
                 normalize = TRUE,
                 verbose = FALSE)

}
